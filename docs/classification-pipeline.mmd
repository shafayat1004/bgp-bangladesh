---
title: "BGP Bangladesh: Full Classification Pipeline"
---
flowchart TB
    %% â”€â”€ Styling â”€â”€
    classDef apiNode fill:#4A90D9,stroke:#2C5F8A,color:#fff,font-weight:bold
    classDef processNode fill:#F5A623,stroke:#C47D0E,color:#fff,font-weight:bold
    classDef dataNode fill:#7ED321,stroke:#4A8A0E,color:#fff,font-weight:bold
    classDef classifyNode fill:#D0021B,stroke:#8B0013,color:#fff,font-weight:bold
    classDef resultNode fill:#9013FE,stroke:#5E0DA6,color:#fff,font-weight:bold
    classDef decisionNode fill:#50E3C2,stroke:#2DA88E,color:#000,font-weight:bold
    classDef edgeNode fill:#BD10E0,stroke:#7A0A92,color:#fff,font-weight:bold

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 1: External API Queries
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase1["Phase 1 â€” External API Queries"]
        direction TB

        API1["â‘  RIPEstat<br/>country-resource-list<br/>resource=BD"]:::apiNode
        API1 --> |"ASN list + IPv4/v6 prefixes"| D1["country_asns set<br/>(all BD-registered ASNs)<br/>+ allocated_prefixes"]:::dataNode

        API2["â‘¡ RIPEstat<br/>announced-prefixes<br/>(per BD ASN, 8 parallel)"]:::apiNode
        D1 --> API2
        API2 --> |"actually-announced prefixes"| D2["merged_prefixes<br/>(allocated âˆª announced)"]:::dataNode

        API3["â‘¢ RIPEstat<br/>bgp-state<br/>(batched by URL length)"]:::apiNode
        D2 --> API3
        API3 --> |"{ target_prefix, source_id, path[] }"| D3["raw BGP routes<br/>(deduplicated by<br/>prefix + collector)"]:::dataNode
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 2: AS Path Analysis
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase2["Phase 2 â€” AS Path Analysis"]
        direction TB

        P1["Clean AS Paths<br/>â€¢ Remove AS-prepending<br/>â€¢ Deduplicate consecutive ASNs<br/>â€¢ Skip malformed routes"]:::processNode
        D3 --> P1

        P2["Walk-Backwards Algorithm<br/>For each path, walk rightâ†’left<br/>from origin while ASN âˆˆ country_asns"]:::processNode
        P1 --> P2

        P3["Identify 3 Key ASNs:<br/>â€¢ OUTSIDE = last non-BD ASN<br/>â€¢ GATEWAY = first BD ASN<br/>â€¢ ORIGIN = rightmost ASN"]:::processNode
        P2 --> P3

        P4["Accumulate Counters:<br/>â€¢ outside_counts<br/>â€¢ iig_counts<br/>â€¢ edge_intl outsideâ†’gateway<br/>â€¢ edge_domestic originâ†’gateway<br/>â€¢ direct_peers adjacency"]:::processNode
        P3 --> P4
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 3: Edge Selection
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase3["Phase 3 â€” Edge Selection & Customer Detection"]
        direction TB

        E1["Select Top Edges:<br/>â€¢ top 1500 international edges<br/>â€¢ top 2000 domestic edges"]:::processNode
        P4 --> E1

        E2["Build iigs_with_domestic set<br/>= all gateway ASNs that appear<br/>as TARGET of a domestic edge"]:::processNode
        E1 --> E2
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 4: Enrichment APIs
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase4["Phase 4 â€” Enrichment Queries"]
        direction TB

        API4["â‘£ RIPEstat<br/>as-overview<br/>(per unique ASN)"]:::apiNode
        API4 --> |"holder name + announced bool"| D4["ASN names & countries<br/>(parsed from holder string)"]:::dataNode

        API5["â‘¤ RIPEstat<br/>maxmind-geo-lite-<br/>announced-by-as<br/>(per gateway ASN)"]:::apiNode
        API5 --> |"IP geolocation breakdown"| D5["geo_country &<br/>dominant_country<br/>per ASN"]:::dataNode

        API6["â‘¥ PeeringDB<br/>net + ix APIs<br/>(batch by ASN list)"]:::apiNode
        API6 --> |"facilities, IXP memberships"| D6["peering_country &<br/>peering_details<br/>per gateway ASN"]:::dataNode

        API7["â‘¦ BTRC License List<br/>btrc_iig_licenses.json<br/>(static local file)"]:::apiNode
        API7 --> D7["btrc_licensed_asns set<br/>(38 ASNs across ~26 companies)"]:::dataNode
    end

    E2 --> Phase4

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% GEO LOGIC
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph GeoLogic["Dominant Country Logic"]
        direction TB
        G1{"BD IP % > 80%?"}:::decisionNode
        G1 -->|"YES"| G2["dominant_country = BD"]:::dataNode
        G1 -->|"NO"| G3["dominant_country =<br/>highest non-BD country"]:::dataNode
    end

    D5 --> GeoLogic

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 5: Classification Decision Tree
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase5["Phase 5 â€” Classification Decision Tree"]
        direction TB

        C0["For each ASN appearing<br/>at the border crossing<br/>(tentative type = iig)"]:::classifyNode

        C1{"ASN in<br/>btrc_licensed_asns?"}:::decisionNode
        C0 --> C1

        C1 -->|"YES"| R1["âœ… iig<br/>Licensed International<br/>Internet Gateway"]:::resultNode

        C1 -->|"NO"| C2{"BD-registered<br/>AND<br/>geo_country â‰  BD?"}:::decisionNode

        C2 -->|"YES<br/>(offshore)"| C3{"Has domestic<br/>customers?<br/>(ASN âˆˆ iigs_with_domestic)"}:::decisionNode

        C3 -->|"YES"| R2["âš ï¸ offshore-gateway<br/>Rogue: abroad +<br/>selling BD transit"]:::resultNode
        C3 -->|"NO"| R3["ğŸ¢ offshore-enterprise<br/>Harmless: abroad,<br/>no BD customers"]:::resultNode

        C2 -->|"NO<br/>(domestic)"| C4{"Has domestic<br/>customers?<br/>(ASN âˆˆ iigs_with_domestic)"}:::decisionNode

        C4 -->|"YES"| R4["ğŸ” detected-iig<br/>Unlicensed gateway<br/>acting as IIG"]:::resultNode
        C4 -->|"NO"| R5["ğŸ  local-company<br/>Demoted: no<br/>downstream customers"]:::resultNode
    end

    Phase4 --> Phase5
    GeoLogic --> Phase5

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% NON-BORDER ASNS
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph OtherTypes["Non-Border ASN Types"]
        direction LR
        R6["ğŸŒ outside<br/>International transit<br/>provider (non-BD)"]:::resultNode
        R7["ğŸ  local-company<br/>Origin ASN announcing<br/>its own BD prefix"]:::resultNode
    end

    P3 --> |"OUTSIDE ASN<br/>(non-BD)"| R6
    P3 --> |"ORIGIN ASN<br/>(BD, not a gateway)"| R7

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 6: Edge Classification
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase6["Phase 6 â€” Edge Classification"]
        direction LR
        EC1["international edge<br/>outside â†’ gateway<br/>(traffic entering BD)"]:::edgeNode
        EC2["domestic edge<br/>local-company â†’ gateway<br/>(internal transit)"]:::edgeNode
    end

    Phase5 --> Phase6

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PHASE 7: Output
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Phase7["Phase 7 â€” Output"]
        direction LR
        O1["viz_data.json<br/>nodes + edges + stats"]:::dataNode
        O2["asn_names.json<br/>ASN registry"]:::dataNode
        O3["metadata.json<br/>pipeline metadata"]:::dataNode
    end

    Phase6 --> Phase7
